{% extends 'layout.twig' %}

{% block body %}
	<div class="user-form2" id="userform2">
		<div class="right">
			<form class="accountWrapper">
				<fieldset>
					
					<div class="form-group">
						<label>{{ i18n.__("Enter Message to Sign") }}</label>
						<textarea id="message" name="message" class="form-control" autofocus style="width:100%; height: 100px;" ></textarea>
					</div>
					
					<div class="form-group">
						<label>{{ i18n.__("Your Encryption Password") }}</label>
						<input id="password" type="password" name="password" class="form-control form-control-password" />
						<span id="passerr" style="color: red;"></span>
					</div>
					<button id="signbutton" class="btn btn-primary nimmu-user-sibmit-button">{{ i18n.__("Sign") }}</button>
					<div class="progress" id="signprogress" style="display:none; height:50px;">
					  <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%; color: #fff; text-align:center;">{{ i18n.__("Signing Message") }} ...</div>
					</div>

					<div class="form-group mt-4" id="publickey"></div>
					<div class="form-group" id="signature"></div>
					<div class="form-group" id="vmessage" style="color: red; text-align:center;"></div>
					
				</fieldset>
			</form>
		</div>
	</div>
{% endblock %}
{% block javascripts %}
<script>

$(document).ready(function() {

	$('#signbutton').on('click', (e) => {
  
  		e.preventDefault();

		if ($('#password').val() == '')
		{

			$('#passerr').html("{{ i18n.__("Error: Enter your encryption password") }}");
	
		}
		else
		{

			$('#signbutton').hide();
			$('#signprogress').show();
		
			socket.emit('signMessage', $('#message').val(), $('#password').val(), function(signResponse) {

				$('#signbutton').show();
				$('#signprogress').hide();
			
				if (signResponse.status == "OK")
				{
				
					$('#publickey').html(`<label>{{ i18n.__("Public Key (For validating)") }}</label>
										<textarea class="form-control" style="width:100%; height:80px;">` + signResponse.publicKey + `</textarea>`);

					$('#signature').html(`<label>{{ i18n.__("Signature") }}</label>
										<textarea class="form-control" style="width:100%; height:80px;">` + signResponse.signature + `</textarea>`);
								
					$('#vmessage').html(`{{ i18n.__("Give the person whom you want to validate this message 3 items:  The message, your public key, and the signature.") }}`);		


				}
				else if (signResponse.status == 'BADPASS')
				{

					$('#passerr').html("{{ i18n.__("Error: Invalid password.") }}");

				}
				else
				{
			
					$('#passerr').html("{{ i18n.__("Error: An unknown error occurred.") }}");
			
				}

			});
			
		}

  		
  	});

});    

</script>
{% endblock %}