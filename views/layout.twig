<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />



  <title>{{ i18n.__("Pandanite Wallet") }} {{ version }}</title>

  <!-- Bootstrap core CSS -->
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  
  <link href="../vendor/fontawesome/css/fontawesome.css" rel="stylesheet">
  <link href="../vendor/fontawesome/css/brands.css" rel="stylesheet">
  <link href="../vendor/fontawesome/css/solid.css" rel="stylesheet">
  
  <link href="../vendor/grid/mermaiddark.css" rel="stylesheet">
  <link href="../static/main.css" rel="stylesheet">

    <style>

		/* GridJs Overrides */
		
    	/* fix */
		.gridjs-table{
			min-width: 100%;
		}
		
		/*
		.gridjs-container {
			color: #000;
		}
		*/
		
		.gridjs-wrapper {
			border-radius: 4px 4px 0 0;
			box-shadow: unset;
		}

		th.gridjs-th {
			padding: 3px;
			border: 0px;
		}

		th.gridjs-th:not(.gridjs-th-sort) {
			padding-right:15px;
		}
		
		th.gridjs-th .gridjs-th-content {
			text-align: center;
			padding-left:10px;
			font-weight: normal;
			font-size: 12px;
			padding-top: 3px;
		}		
		
		td.gridjs-td {
			border: 0px;
			border-bottom: 1px solid #ccc;
			padding: 6px 12px;
		}

		/*
		.gridjs-table tr:nth-child(2n+2){
			background: #ddd;
		}
		*/
		
		.swal-text:first-child {
			margin-top: 0px;
			padding: 10px;
			font-weight: bold;
			border-bottom: 1px solid #aaa;
    		width: 100%;
    		border-top-right-radius: 5px;
    		border-top-left-radius: 5px;
    		color: #fff;
    		background-color: #12121c;
    		max-width: 100%;
    	}
    	
		.swal-footer {
		  background-color: #12121c;
		  border-top: 1px solid #E9EEF1;
		  overflow: hidden;
		}
		
		.popover {
			z-index: 99999;
		}
		
		.swal-button--confirm {
			width: 100px;
			background: #FED31F; /*#1b236e;*/
			border: 2px solid #FED31F; /*#1b236e;*/
			color: #000;
			height: 40px;
			line-height: 40px;
			padding: 0;
			font-size: 16px;
		}

		.swal-button--confirm:hover {
			color: #fff;
    		background: #0b5ed7;
   			border-color: #0a58ca;
		}
		
		//
		
	</style>



</head>

<body>

	<div style="position: absolute; width: 100%; height: 100vh;">
	  <!-- Navigation -->
	  <nav id="topnav" class="navbar navbar-expand-lg navbar-dark bg-dark static-top" style="top:0px;height:40px;display: flex;">
		
		<!--img src="../static/media/bamboo-bmb-logo.png" style="height:35px; position: absolute;top: 2px;left: 65px;"-->

		<div style="display: flex;align-items: center;margin-left: auto; margin-right: auto;">
	
		  <a id="gotohome" class="navbar-brand active" href="javascript:void (0);" style="margin-left:30px; vertical-align: middle;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="width:24px; height:24px;"><path fill="#ccc" d="M11 39h7.5V26.5h11V39H37V19.5L24 9.75 11 19.5Zm-3 3V18L24 6l16 12v24H26.5V29.5h-5V42Zm16-17.65Z"/></svg> {{ i18n.__("Home") }}</a>
		  
		  <a id="gotosend" class="navbar-brand" href="javascript:void (0);" style="margin-left:20px; vertical-align: middle;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="width:24px; height:24px;"><path fill="#ccc" d="M22.5 40V13.7L10.1 26.1 8 24 24 8l16 16-2.1 2.1-12.4-12.4V40Z"/></svg> {{ i18n.__("Send") }}</a>
		  
		  <a id="gotoreceive" class="navbar-brand" href="javascript:void (0);" style="margin-left:20px; vertical-align: middle;;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="width:24px; height:24px;"><path fill="#ccc" d="M24 40 8 24l2.1-2.1 12.4 12.4V8h3v26.3l12.4-12.4L40 24Z"/></svg> {{ i18n.__("Receive") }}</a>

		  <a id="gotosign" class="navbar-brand" href="javascript:void (0);" style="margin-left:20px; vertical-align: middle;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="width:24px; height:24px;"><path fill="#ccc" d="M9 47.4q-1.2 0-2.1-.9-.9-.9-.9-2.1v-30q0-1.2.9-2.1.9-.9 2.1-.9h20.25l-3 3H9v30h30V27l3-3v20.4q0 1.2-.9 2.1-.9.9-2.1.9Zm15-18Zm9.1-17.6 2.15 2.1L21 28.1v4.3h4.25l14.3-14.3 2.1 2.1L26.5 35.4H18v-8.5Zm8.55 8.4-8.55-8.4 5-5q.85-.85 2.125-.85t2.125.9l4.2 4.25q.85.9.85 2.125t-.9 2.075Z"/></svg> {{ i18n.__("Sign") }}</a>
		  
		  <a id="gotoverify" class="navbar-brand" href="javascript:void (0);" style="margin-left:20px; vertical-align: middle;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="width:24px; height:24px;"><path fill="#ccc"  d="m17.3 45-3.8-6.5-7.55-1.55.85-7.35L2 24l4.8-5.55-.85-7.35 7.55-1.55L17.3 3 24 6.1 30.7 3l3.85 6.55 7.5 1.55-.85 7.35L46 24l-4.8 5.6.85 7.35-7.5 1.55L30.7 45 24 41.9Zm1.35-3.95L24 38.8l5.5 2.25 3.35-5 5.85-1.5-.6-5.95 4.05-4.6-4.05-4.7.6-5.95-5.85-1.4-3.45-5L24 9.2l-5.5-2.25-3.35 5-5.85 1.4.6 5.95L5.85 24l4.05 4.6-.6 6.05 5.85 1.4ZM24 24Zm-2.15 6.65L33.2 19.4l-2.25-2.05-9.1 9-4.75-4.95-2.3 2.25Z"/></svg> {{ i18n.__("Verify") }}</a>

		  <a id="gotosettings" class="navbar-brand" href="javascript:void (0);" style="margin-left:20px; vertical-align: middle;"><span class="position-relative"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="width:24px; height:24px;"><path fill="#ccc" d="m19.4 44-1-6.3q-.95-.35-2-.95t-1.85-1.25l-5.9 2.7L4 30l5.4-3.95q-.1-.45-.125-1.025Q9.25 24.45 9.25 24q0-.45.025-1.025T9.4 21.95L4 18l4.65-8.2 5.9 2.7q.8-.65 1.85-1.25t2-.9l1-6.35h9.2l1 6.3q.95.35 2.025.925Q32.7 11.8 33.45 12.5l5.9-2.7L44 18l-5.4 3.85q.1.5.125 1.075.025.575.025 1.075t-.025 1.05q-.025.55-.125 1.05L44 30l-4.65 8.2-5.9-2.7q-.8.65-1.825 1.275-1.025.625-2.025.925l-1 6.3ZM24 30.5q2.7 0 4.6-1.9 1.9-1.9 1.9-4.6 0-2.7-1.9-4.6-1.9-1.9-4.6-1.9-2.7 0-4.6 1.9-1.9 1.9-1.9 4.6 0 2.7 1.9 4.6 1.9 1.9 4.6 1.9Zm0-3q-1.45 0-2.475-1.025Q20.5 25.45 20.5 24q0-1.45 1.025-2.475Q22.55 20.5 24 20.5q1.45 0 2.475 1.025Q27.5 22.55 27.5 24q0 1.45-1.025 2.475Q25.45 27.5 24 27.5Zm0-3.5Zm-2.2 17h4.4l.7-5.6q1.65-.4 3.125-1.25T32.7 32.1l5.3 2.3 2-3.6-4.7-3.45q.2-.85.325-1.675.125-.825.125-1.675 0-.85-.1-1.675-.1-.825-.35-1.675L40 17.2l-2-3.6-5.3 2.3q-1.15-1.3-2.6-2.175-1.45-.875-3.2-1.125L26.2 7h-4.4l-.7 5.6q-1.7.35-3.175 1.2-1.475.85-2.625 2.1L10 13.6l-2 3.6 4.7 3.45q-.2.85-.325 1.675-.125.825-.125 1.675 0 .85.125 1.675.125.825.325 1.675L8 30.8l2 3.6 5.3-2.3q1.2 1.2 2.675 2.05Q19.45 35 21.1 35.4Z"/></svg>{% if (version != latestVersion) %}<span class="position-absolute top-0 start-100 translate-middle bg-danger border border-light rounded-circle" style="padding: .2rem!important;"></span>{% endif %}</span> {{ i18n.__("Settings") }}</a>

		  <a id="gotologout" class="navbar-brand" href="javascript:void (0);" style="margin-left:20px; vertical-align: middle;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="width:24px; height:24px;"><path fill="#ccc" d="M9 42q-1.2 0-2.1-.9Q6 40.2 6 39V9q0-1.2.9-2.1Q7.8 6 9 6h14.55v3H9v30h14.55v3Zm24.3-9.25-2.15-2.15 5.1-5.1h-17.5v-3h17.4l-5.1-5.1 2.15-2.15 8.8 8.8Z"/></svg> {{ i18n.__("Logout") }}</a>

	  
		</div>
	  </nav>

	  <!-- Page Content -->
	  <div id="maincontent" class="container" style="margin:0px; padding:0px; max-width:100%; padding-left:10px; padding-right:10px;">

{% block body %}{% endblock %}

	  </div>
  
  </div>

  <footer id="mainfooter" style="position: fixed; z-index:99999; bottom:0px; background-color: #000; height:19px; width:100%;">
	<div style="display: flex; flex-direction: row; margin: auto; font-size:13px; max-width:100%;">

		<div style="flex:1; width:33%; display: inline-block; text-align:left; white-space: nowrap; overflow: visible; margin-left:10px;">
			<span style="margin-right:20px;" id="connectionStatus">
						<svg style="margin-top:-3px;" width="16" height="12" viewBox="0 0 16 12" fill="none" xmlns="http://www.w3.org/2000/svg">
							<rect y="9.667" width="1.67" height="2.5" fill="#CCC"></rect>
							<rect x="4.44446" y="5.667" width="1.66667" height="6.67" fill="#CCC"></rect>
							<rect x="8.88892" y="3" width="1.66667" height="10.83" fill="#CCC"></rect>
							<rect x="13.3333" width="1.66667" height="15" fill="#CCC"></rect>
						</svg>
			</span>
		</div>
		
		<div style="flex:1; width:34%; text-align:center;">
		
			Pandanite Wallet
		
		</div>
		
		<div style="flex:1;  width:33%; display: inline-block; text-align:right; white-space: nowrap; overflow: visible; margin-right:10px; color: #fff;">
			{{ i18n.__("Block #") }} <span id="blockChainHeight">0</span>			
		</div>

	</div>
  </footer>
  <script>
    //load in node libraries
    require('../renderer.js')
  </script>
  <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../vendor/grid/gridjs.umd.js"></script>
  <script src="../vendor/clipboard.min.js"></script>
  <script src="../vendor/sweetalert.min.js"></script>
  <script src="../vendor/jquery.nicescroll.min.js"></script>

  <script>
  
  	var myTemplate, normalContent, clonedTemplate;
  
  	$('#gotohome').on('click', function() {

  	  //router.route('GET', '/account', () => {});
  		
  	  $('.navbar-brand').removeClass('active');
  	  $(this).addClass('active');
  		
      myTemplate = document.getElementById('templateAccountPage');
      normalContent = document.getElementById('maincontent');
      clonedTemplate = myTemplate.content.cloneNode(true);
      normalContent.innerHTML = "";
      normalContent.appendChild(clonedTemplate);
      
      loadAccountPage();
  	
  	});

  	$('#gotosend').on('click', function() {
  	
  		//router.route('GET', '/send', () => {});

  	  $('.navbar-brand').removeClass('active');
  	  $(this).addClass('active');
  	  
      myTemplate = document.getElementById('templateSendPage');
      normalContent = document.getElementById('maincontent');
      clonedTemplate = myTemplate.content.cloneNode(true);
      normalContent.innerHTML = "";
      normalContent.appendChild(clonedTemplate);
      
      loadSendPage();
      
  	});
  	
  	$('#gotoreceive').on('click', function() {
  	
  		//router.route('GET', '/receive', () => {});
  		
  	  $('.navbar-brand').removeClass('active');
  	  $(this).addClass('active');
  	  
      myTemplate = document.getElementById('templateReceivePage');
      normalContent = document.getElementById('maincontent');
      clonedTemplate = myTemplate.content.cloneNode(true);
      normalContent.innerHTML = "";
      normalContent.appendChild(clonedTemplate);
      
      loadReceivePage();
      
  	});

  	$('#gotosign').on('click', function() {
  	
  		//router.route('GET', '/sign', () => {});
  		
  	  $('.navbar-brand').removeClass('active');
  	  $(this).addClass('active');
  	  
      myTemplate = document.getElementById('templateSignPage');
      normalContent = document.getElementById('maincontent');
      clonedTemplate = myTemplate.content.cloneNode(true);
      normalContent.innerHTML = "";
      normalContent.appendChild(clonedTemplate);
      
      loadSignPage();
      
  	});

  	$('#gotoverify').on('click', function() {
  	
  		//router.route('GET', '/verify', () => {});

  	  $('.navbar-brand').removeClass('active');
  	  $(this).addClass('active');
  	  
      myTemplate = document.getElementById('templateVerifyPage');
      normalContent = document.getElementById('maincontent');
      clonedTemplate = myTemplate.content.cloneNode(true);
      normalContent.innerHTML = "";
      normalContent.appendChild(clonedTemplate);
      
      loadVerifyPage();
      
  	});
  	
  	$('#gotosettings').on('click', function() {
  	
  		//router.route('GET', '/settings', () => {});

  	  $('.navbar-brand').removeClass('active');
  	  $(this).addClass('active');
  	  
      myTemplate = document.getElementById('templateSettingsPage');
      normalContent = document.getElementById('maincontent');
      clonedTemplate = myTemplate.content.cloneNode(true);
      normalContent.innerHTML = "";
      normalContent.appendChild(clonedTemplate);
      
      loadSettingsPage();
      
  	});
  	
  	$('#gotologout').on('click', function() {
  	
  		router.route('GET', '/logout', () => {});
  	
  	});

  	$('#gotomainscreen').on('click', function() {
  	
  		router.route('GET', '/main', () => {});
  	
  	});
	
	$(window).on("blockStats", function(e, blockStats) {

		$('#blockChainHeight').html(blockStats.blockChainHeight);

		if (blockStats.isConnected == true)
		{

			$('#connectionStatus').html(`<svg style="margin-top:-3px;" width="16" height="12" viewBox="0 0 16 12" fill="none" xmlns="http://www.w3.org/2000/svg">
									<rect y="9.667" width="1.67" height="2.5" fill="#00C186"></rect>
									<rect x="4.44446" y="5.667" width="1.66667" height="6.67" fill="#00C186"></rect>
									<rect x="8.88892" y="3" width="1.66667" height="10.83" fill="#00C186"></rect>
									<rect x="13.3333" width="1.66667" height="15" fill="#00C186"></rect>
								</svg>`);
						
		}
		else
		{

			$('#connectionStatus').html(`<svg style="margin-top:-3px;" width="16" height="12" viewBox="0 0 16 12" fill="none" xmlns="http://www.w3.org/2000/svg">
									<rect y="9.667" width="1.67" height="2.5" fill="#CCC"></rect>
									<rect x="4.44446" y="5.667" width="1.66667" height="6.67" fill="#CCC"></rect>
									<rect x="8.88892" y="3" width="1.66667" height="10.83" fill="#CCC"></rect>
									<rect x="13.3333" width="1.66667" height="15" fill="#CCC"></rect>
								</svg>`);

		}

	});

	var grid;
	
	function loadAccountPage()
	{

		var loadedAddress = "{{loadedAccount}}";

		new ClipboardJS('#copyaddress');
	
		$('#copyaddress').popover({trigger: 'focus', content: "{{ i18n.__("Copied") }}", delay: { "hide": 900 }});
	
		function forceRefresh() {

			$('#forcerefrsh').addClass('fa-spin');
		
			window.emitMessage('forcerefresh', '', function(){});
	
		}
	
		grid = new gridjs.Grid({
		  columns: [
			{
				id: 'date',
				name: '{{ i18n.__("Date") }}'
			},
			{
				id: 'type',
				name: '{{ i18n.__("Type") }}',
				formatter: (cell) => {
					return gridjs.html(cell == 'Send' ? '<span style="color:rgb(255, 87, 97);">{{ i18n.__("Send") }}</span>' : '<span style="color:rgb(0, 193, 134);">{{ i18n.__("Receive") }}</span>');
				},
			},
			{
				id: 'txid',
				name: '{{ i18n.__("Transaction Id") }}'
			},
			{
				id: 'amount',
				name: '{{ i18n.__("Amount") }}',
				formatter: (cell) => {
					return gridjs.html("<div style='text-align:right;'>" + cell + " PDN</div>");
				},
				sort: {
					compare: (a, b) => {
					  const code = (x) => parseFloat(x.replace(" PDN", ''));

					  if (code(a) > code(b)) {
						return 1;
					  } else if (code(b) > code(a)) {
						return -1;
					  } else {
						return 0;
					  }
					}
				}
			},
			{
				id: 'from',
				hidden: true
			},
			{
				id: 'to',
				hidden: true
			}
		  ],
		  search: {
			enabled: true
		  },
		  language: {
			'search': {
			  'placeholder': "🔍 {{ i18n.__("search") }}..."
			},
			'pagination': {
			  'previous': "{{ i18n.__("previous") }}️",
			  'next': "{{ i18n.__("next") }}",
			  'showing': "{{ i18n.__("showing") }}",
			  'results': "{{ i18n.__("results") }}",
			  'navigate': (page, pages) => `{{ i18n.__("Page") }} ${page} {{ i18n.__("of") }} ${pages}`,
			  'page': (page) => `{{ i18n.__("Page") }} ${page}`,
			  'of': "{{ i18n.__("of") }}",
			  'to': "{{ i18n.__("to") }}"
			},
		    sort: {
			  'sortAsc': "{{ i18n.__("Sort column ascending") }}",
			  'sortDesc': "{{ i18n.__("Sort column descending") }}"
		    },
		    loading: "{{ i18n.__("Loading") }}...",
		    noRecordsFound: "{{ i18n.__("No matching records found") }}",
		    error: "{{ i18n.__("An error happened while fetching the data") }}"
		  },
		  style: { 
			table: { 
			  'white-space': 'nowrap'
			}
		  },
		  sort: {
			multiColumn: true
		  },
		  pagination: {
			enabled: true
		  },
		  fixedHeader: false,
		  maxHeight: 'calc(100vh - 195px)',
		  data: () => {
			return new Promise(resolve => {
		
				window.emitMessage('transactionList', '', function(data) {

					resolve(
					  data.map(txinfo => [
						(new Date(parseInt(txinfo.timestamp))).toLocaleString(),
						txinfo.to == loadedAddress ? 'Receive' : 'Send',
						gridjs.html(`<span class='transactioninfo' data-pending="` + (txinfo.pending?txinfo.pending:false) + `" data-txid="` + txinfo.txid + `" data-from="` + txinfo.from + `" data-to="` + txinfo.to + `" data-amount="` + txinfo.amount + `" data-fee="` + txinfo.fee + `" data-timestamp="` + txinfo.timestamp + `" style='font-weight:bold; color: #FED31F; cursor: pointer;'>`+txinfo.txid+`</span>` + (txinfo.pending==true?` <i class="fa-regular fa-clock"></i>`:``)),
						Big(txinfo.amount).div(10**4).toFixed(4),
						txinfo.from,
						txinfo.to
					  ])
					);

				});
		
			});
		  }
		}).render(document.getElementById("transactiongrid"));

		class RightTopSpanPlugin extends gridjs.BaseComponent {

			render() {
  
				return gridjs.h('span', {
									style: 'color: #fff; float:right; font-size:22px; padding: 5px; padding-right:0px;',
									id: 'accountValue',
									}, '');

			}
		
		}

		grid.plugin.add({
		  id: 'accountValue',
		  component: RightTopSpanPlugin,
		  position: gridjs.PluginPosition.Header,
		  order: 1
		});

		grid.on('ready', function() {
		
			infoButtons();

			window.emitMessage('accountInfo', '', function(accountInfo) {

				$('#accountaddress').html(accountInfo.address);
		
				loadedAddress = accountInfo.address;
		
				let formattedBalance = Big(0).toFixed(4) + " PDN <i id='forcerefrsh' class='fa-solid fa-sync' style='cursor:pointer; color: #FED31F;'></i>";
		
				try {
					formattedBalance = Big(accountInfo.balance).toFixed(4) + " PDN <i id='forcerefrsh' class='fa-solid fa-sync' style='cursor:pointer; color: #FED31F;'></i>";
				} catch (e) {
		
				}
		
				$('#accountValue').html(formattedBalance);
		
				$('#forcerefrsh').off('click');
				$('#forcerefrsh').on('click', function() {
					forceRefresh();
				});

			});
		
		});

		function infoButtons() {
	
			$('.transactioninfo').off('click');
			$('.transactioninfo').on('click', function() {
	
				let thistxid = $(this).data('txid');
				let thisfrom = $(this).data('from');
				let thisto = $(this).data('to');
				if (thisfrom == "") thisfrom = "New Coins";
				let thispending = $(this).data('pending');

				let thisamount = '0.0000';
			
				try {
					thisamount = Big($(this).data('amount')).div(10**4).toFixed(4);
				} catch (e) {
				
				}	
			
				let thisfee = '0.0000';
			
				try {
					thisfee = Big($(this).data('fee')).div(10**4).toFixed(4);
				} catch (e) {
				
				}
			
				let thistimestamp = $(this).data('timestamp');

				var htmlcode = `<div style="color: #fff; background-color: #000;">
						<div style="margin-left:-20px; margin-right: -20px; padding:2px; padding-left:10px; background-color: #191919; font-size:12px;">{{ i18n.__("Transaction ID") }} &nbsp;&nbsp; <button class="copy-button" data-clipboard-target="#copy-input-txid" style="font-weight: bold; border:0px; padding:0px; margin:0px; color: #FED31F; background:transparent;"><svg style="width:16px; height:16px;color: #FED31F; " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M224 0c-35.3 0-64 28.7-64 64V288c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H224zM64 160c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H288c35.3 0 64-28.7 64-64V384H288v64H64V224h64V160H64z"/></svg></button></div>
						<div id="copy-input-txid" class="nicescrollable" style="padding:2px;">` + thistxid + `</div>
						<div style="margin-left:-20px; margin-right: -20px; padding:2px; padding-left:10px; background-color: #191919; font-size:12px;">{{ i18n.__("From Address") }} &nbsp;&nbsp; <button class="copy-button" data-clipboard-target="#copy-input-addr" style="font-weight: bold;  border:0px; padding:0px; margin:0px; color: #FED31F; background:transparent;"><svg style="width:16px; height:16px;color: #FED31F; " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M224 0c-35.3 0-64 28.7-64 64V288c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H224zM64 160c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H288c35.3 0 64-28.7 64-64V384H288v64H64V224h64V160H64z"/></svg></button></div>
						<div id="copy-input-addr" class="nicescrollable" style="padding:2px;">` + thisfrom + `</div>
						<div style="margin-left:-20px; margin-right: -20px; padding:2px; padding-left:10px; background-color: #191919; font-size:12px;">{{ i18n.__("To Address") }} &nbsp;&nbsp; <button class="copy-button" data-clipboard-target="#copy-input-addr2" style="font-weight: bold;  border:0px; padding:0px; margin:0px; color: #FED31F; background:transparent;"><svg style="width:16px; height:16px;color: #FED31F; " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M224 0c-35.3 0-64 28.7-64 64V288c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H224zM64 160c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H288c35.3 0 64-28.7 64-64V384H288v64H64V224h64V160H64z"/></svg></button></div>
						<div id="copy-input-addr2" class="nicescrollable" style="padding:2px;">` + thisto + `</div>
						<div style="margin-left:-20px; margin-right: -20px; padding:2px; padding-left:10px; background-color: #191919; font-size:12px;">{{ i18n.__("Amount") }}</div>
						<div style="padding:2px;" class="nicescrollable">` + thisamount + `</div>
						<div style="margin-left:-20px; margin-right: -20px; padding:2px; padding-left:10px; background-color: #191919; font-size:12px;">{{ i18n.__("Fee") }}</div>
						<div style="padding:2px;" class="nicescrollable">` + thisfee + `</div>
						<div style="margin-left:-20px; margin-right: -20px; padding:2px; padding-left:10px; background-color: #191919; font-size:12px;">{{ i18n.__("Timestamp") }}</div>
						<div style="padding:2px;" class="nicescrollable">` + (new Date(parseInt(thistimestamp))).toLocaleString() + `</div>
						<div style="margin-left:-20px; margin-right: -20px; padding:2px; padding-left:10px; background-color: #191919; font-size:12px;">{{ i18n.__("Status") }}</div>
						<div style="padding:2px;" class="nicescrollable">` + (thispending==true?'{{ i18n.__("Pending") }}':'{{ i18n.__("Confirmed") }}') + `</div>
						</div>`;

				var frag = document.createRange().createContextualFragment('<div style="text-align:left; color: #fff; background-color: #000;">' + htmlcode + '</div>');
  
				let wrapper = document.createElement('div');
				wrapper.appendChild(frag);

				const el = wrapper.firstChild;
  
				const swaltext = "{{ i18n.__("Transaction Details") }}";
		  
				swal({
				  text: swaltext,
				  content: el,
				  buttons: {
					confirm: "{{ i18n.__("OK") }}",
				  },
				});
				
				$(".nicescrollable").niceScroll();

				new ClipboardJS('.copy-button');
	
				$('.copy-button').popover({trigger: 'focus', content: "{{ i18n.__("Copied") }}", delay: { "hide": 900 }});

			});
	
		}

		$(window).off('accountUpdate');
		$(window).on('accountUpdate', function (e) { 

			grid.updateConfig({
			  data: () => {
				return new Promise(resolve => {
		
					window.emitMessage('transactionList', '', function(data) {
					
						resolve(
						  data.map(txinfo => [
							(new Date(parseInt(txinfo.timestamp))).toLocaleString(),
							txinfo.to == loadedAddress ? 'Receive' : 'Send',
							gridjs.html(`<span class='transactioninfo' data-pending="` + (txinfo.pending?txinfo.pending:false) + `" data-txid="` + txinfo.txid + `" data-from="` + txinfo.from + `" data-to="` + txinfo.to + `" data-amount="` + txinfo.amount + `" data-fee="` + txinfo.fee + `" data-timestamp="` + txinfo.timestamp + `" style='font-weight:bold; color: #FED31F; cursor: pointer;'>`+txinfo.txid+`</span>` + (txinfo.pending==true?` <i class="fa-regular fa-clock"></i>`:``)),
							Big(txinfo.amount).div(10**4).toFixed(4)
						  ])
						);

					});
		
				});
			  },
			  plugins: [
				{
				  id: 'accountValue',
				  component: RightTopSpanPlugin,
				  position: gridjs.PluginPosition.Header,
				  order: 1
				}
			  ]
			}).forceRender();
		
		});

	} 
	
  	function loadSendPage()
  	{

		window.emitMessage('accountInfo', '', function(accountInfo) {

		  $('#amount').html(accountInfo.balance);
				
		  $('#sendall').off('click');
		  $('#sendall').on('click', function() {

			try {

				$('#amount').val(Big($(this).html()).minus(0.0001).toFixed(4));
	
			} catch (e) {

				$('#amount').val('0.0000');

			}

		  });  
  
		  $('#amount').off('change');
		  $('#amount').on('change', function() {

			try {

				$('#amount').val(Big($('#amount').val()).toFixed(4));
		
				if (Big($('#amount').val()).lt(0)) $('#amount').val('0.0000');
	
			} catch (e) {

				$('#amount').val('0.0000');

			}

		  });  

		  $('#sendbutton').off('click');
		  $('#sendbutton').on('click', (e) => {

			e.preventDefault();

			let valueErr = false;

			let testValue;
	
			try {

				testValue = Big($('#amount').val());

			} catch (e) {

				valueErr = true;

			}

			if (valueErr)
			{

				$('#amounterr').html("{{ i18n.__("Error: Enter a valid amount") }}");

			}
			else if (Big(testValue).minus(0.0001).gt({{accountBalance}}))
			{

				$('#amounterr').html("{{ i18n.__("Error: Value exceeds account balance") }}");

			}
			else if ($('#toaccount').val() == '')
			{
	
				$('#accounterr').html("{{ i18n.__("Error: Enter an account to send to") }}");

			}
			else if ($('#amount').val() == '')
			{

				$('#amounterr').html("{{ i18n.__("Error: Enter an amount") }}");

			}
			else if ($('#password').val() == '')
			{

				$('#passerr').html("{{ i18n.__("Error: Enter your encryption password") }}");

			}
			else
			{

				$('#sendbutton').hide();
				$('#loginprogress').show();
	
				window.emitMessage('sendTransaction', {toaccount: $('#toaccount').val(), amount: $('#amount').val(), password: $('#password').val()}, function(txResponse) {

					if (txResponse == "OK")
					{
		
					  $('.navbar-brand').removeClass('active');
					  $('#gotohome').addClass('active');
	
					  myTemplate = document.getElementById('templateAccountPage');
					  normalContent = document.getElementById('maincontent');
					  clonedTemplate = myTemplate.content.cloneNode(true);
					  normalContent.innerHTML = "";
					  normalContent.appendChild(clonedTemplate);
  
					  loadAccountPage();

					}
					else if (txResponse == 'BADADDRESS')
					{
		
						$('#accounterr').html("{{ i18n.__("Error: Invalid address.") }}");
		
					}
					else if (txResponse == 'BADAMOUNT')
					{
		
						$('#amounterr').html("{{ i18n.__("Error: Invalid amount.") }}");
		
					}
					else if (txResponse == 'BADPASS')
					{

						$('#passerr').html("{{ i18n.__("Error: Invalid password.") }}");

					}
					else
					{
		
						$('#passerr').html("{{ i18n.__("Error: An unknown error occurred.") }}");
		
					}

					$('#sendbutton').show();
					$('#loginprogress').hide();
	
				});
	
			}

		  });
		  
		});

  	
  	}
  	
  	
  	function loadReceivePage() {

		QRCode.toDataURL("{{loadedAccount}}", function (err, url) {
			if(err) return console.log("error occurred")
		
			$('#qrcode').html("<img style='width:300px;' src='" + url + "'>");
		})

		new ClipboardJS('#copyaddress2');
	
		$('#copyaddress2').popover({trigger: 'focus', content: "{{ i18n.__("Copied") }}", delay: { "hide": 900 }});

  	}
  	
  	
  	function loadSignPage() {
  	
  		$('#signbutton').off('click');
		$('#signbutton').on('click', (e) => {
  
			e.preventDefault();

			if ($('#password').val() == '')
			{

				$('#passerr').html("{{ i18n.__("Error: Enter your encryption password") }}");
	
			}
			else
			{

				$('#signbutton').hide();
				$('#signprogress').show();
		
				window.emitMessage('signMessage', {message: $('#message').val(), password: $('#password').val()}, function(signResponse) {

					$('#signbutton').show();
					$('#signprogress').hide();
			
					if (signResponse.status == "OK")
					{
				
						$('#publickey').html(`<label>{{ i18n.__("Public Key (For validating)") }}</label>
											<textarea class="form-control" style="width:100%; height:80px;">` + signResponse.publicKey + `</textarea>`);

						$('#signature').html(`<label>{{ i18n.__("Signature") }}</label>
											<textarea class="form-control" style="width:100%; height:80px;">` + signResponse.signature + `</textarea>`);
								
						$('#vmessage').html(`{{ i18n.__("Give the person whom you want to validate this message 3 items:  The message, your public key, and the signature.") }}`);		


					}
					else if (signResponse.status == 'BADPASS')
					{

						$('#passerr').html("{{ i18n.__("Error: Invalid password.") }}");

					}
					else
					{
			
						$('#passerr').html("{{ i18n.__("Error: An unknown error occurred.") }}");
			
					}

				});
			
			}

		
		});
  	
  	}
  	
  	function loadVerifyPage() {
  	
  		$('#validatebutton').off('click');
		$('#validatebutton').on('click', (e) => {
  
			e.preventDefault();

			if ($('#signature').val() == '')
			{

				$('#signatureerr').html("{{ i18n.__("Error: Enter the signature") }}");
	
			}
			else if ($('#publickey').val() == '')
			{

				$('#publickeyerr').html("{{ i18n.__("Error: Enter the signers public key") }}");
	
			}
			else
			{

				$('#validatebutton').hide();
				$('#validateprogress').show();
		
				window.emitMessage('validateMessage', {message: $('#message').val(), signature: $('#signature').val(), publicKey: $('#publickey').val()}, function(validateResponse) {

					$('#validatebutton').show();
					$('#validateprogress').hide();
			
					if (validateResponse == true)
					{
				
						$('#validateresults').html(`<h2 style="color: green">{{ i18n.__("This message and signature is VALID") }}</h2>`);

						$('#validatebutton').css({background: 'green', border: '2px solid green'});


					}
					else
					{
			
						$('#validateresults').html(`<h2 style="color: red">{{ i18n.__("This message and signature is NOT VALID") }}</h2>`);

						$('#validatebutton').css({background: 'red', border: '2px solid red'});

					}

				});
			
			}

		
		});
  	
  	}
  	
  	function loadSettingsPage() {
  	
	  let currentLocale = "{{ i18n.getLocale() }}";
	  let localesObject = JSON.parse(`{{ localesObject }}`);
	  let availLocales = Object.keys(localesObject);
  
	  availLocales.forEach(item => {
	
		if (item == currentLocale)
		{
		  $('#language').append(`<option selected value="${item}">${localesObject[item]}</option>`);
		}
		else
		{
		  $('#language').append(`<option value="${item}">${localesObject[item]}</option>`);
		}
	
	  });

	  let selectedPeer = "{{ selectedPeer }}";
	  let peers = {{ peers }};
  
	  peers.forEach(item => {
	
		if (item == selectedPeer)
		{
		  $('#peer').append(`<option selected value="${item}">${item}</option>`);
		}
		else
		{
		  $('#peer').append(`<option value="${item}">${item}</option>`);
		}
	
	  });
  
  	  $('#language').off('change');
	  $('#language').on('change', (e) => {
  
		window.emitMessage('updateLocale', $('#language').val(), function(result) {
	
			if (result == true) router.route('GET', '/main', () => {});
	
		});
  
	  });
  
      $('#peer').off('change');
	  $('#peer').on('change', (e) => {
  
		window.emitMessage('updatePeer', $('#peer').val(), function(result) {
	
			if (result == true)
			{

				$('#peer').addClass('is-valid');
				setTimeout(function() {
					$('#peer').removeClass('is-valid');
				},1000);
		
			}
	
		});
  
	  });
  
  	  $('#newpeerbutton').off('click');
	  $('#newpeerbutton').on('click', (e) => {
  
		e.preventDefault();
	
		let thisPeer;
	
		if ($('#peerport').val() == '')
		{
			thisPeer = $('#peerproto').val() + "://" + $('#peerhost').val();
		}
		else
		{
			thisPeer = $('#peerproto').val() + "://" + $('#peerhost').val() + ":" + $('#peerport').val();
		}
	
		var expression = /[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)?/gi;
		var regex = new RegExp(expression);
	
		if (thisPeer.match(regex)) {
	  
			window.emitMessage('addCustomPeer', thisPeer, function(result) {
	
				if (result == true) 
				{
				
					$('#peer').append(`<option selected value="${thisPeer}">${thisPeer}</option>`);
					
					$('#peer').addClass('is-valid');
					setTimeout(function() {
						$('#peer').removeClass('is-valid');
					},1000);
					
				
				}

			});
	  
		}
		else
		{
	
			$('#addpeererr').html("{{ i18n.__("Error: Peer info seems invalid") }}");
	
		}

	  });
	
	  $('#viewbutton').off('click');
	  $('#viewbutton').on('click', (e) => {
  
		e.preventDefault();
	
		if ($('#password').val() == '')
		{

			$('#passerr').html("{{ i18n.__("Error: Enter your encryption password") }}");
	
		}
		else
		{

			$('#viewbutton').show();
			$('#viewprogress').hide();
				
			window.emitMessage('getAccountKeys', $('#password').val(), function(accountInfo) {

				if (accountInfo.address)
				{
			
					$('#userform2').html(`<div class="right" id="webform">
										<form class="accountWrapper">
											<fieldset>
												<center>
												<h1><img src="../static/media/bamboo-bmb-logo.png" style="height:50px;"> {{ i18n.__("Pandanite Wallet") }}</h1>
												</center>
												<div class="form-group" style="margin-top:30px;">
													<label>{{ i18n.__("Your Account Address") }}</label>
													<textarea class="form-control" style="height: 55px;">` + accountInfo.address + `</textarea>
												</div>
											
												<div class="form-group">
													<label>{{ i18n.__("Mnemonic Phrase") }}</label>
													<textarea class="form-control" style="height: 55px;">` + accountInfo.mnemonic + `</textarea>
												</div>
											
												<div class="form-group">
													<label>{{ i18n.__("Seed Password") }}</label>
													<textarea class="form-control" style="height: 55px;">` + accountInfo.seedPassword + `</textarea>
												</div>
											
												<div class="form-group">
													<label>{{ i18n.__("Public Key") }}</label>
													<textarea class="form-control" style="height: 55px;">` + accountInfo.publicKey + `</textarea>
												</div>
											
												<div class="form-group">
													<label>{{ i18n.__("Private Key") }}</label>
													<textarea class="form-control" style="height: 82px;">` + accountInfo.privateKey + `</textarea>
												</div>
											
												<div id="buttonsdiv" style="width:100%; text-align:center">
													<button id="gotoaccount" class="btn btn-primary nimmu-user-sibmit-button" style="width:45%; margin-right:10px;">{{ i18n.__("Continue") }}</button>
													<button id="printpage" class="btn btn-primary nimmu-user-sibmit-button" style="width:45%; margin-left:10px;"><i class="fa-solid fa-print"></i> {{ i18n.__("Print Page") }}</button>
												</div>
												<div id="warningdiv" style="text-align:center; margin-top:10px;">
													<strong>
													{{ i18n.__("Put this in a safe place!") }}<br />
													{{ i18n.__("Do not transmit over insecure methods such as email.") }}<br />
													{{ i18n.__("You can also print this later as long as you have your encryption password.") }}
													</strong>
												</div>
											</fieldset>
										</form>
									</div>`);
								
						$('#gotoaccount').on('click', function(e) {

							e.preventDefault();

				  			$('.navbar-brand').removeClass('active');
				  			$('#gotosettings').addClass('active');
				  
							myTemplate = document.getElementById('templateSettingsPage');
							normalContent = document.getElementById('maincontent');
							clonedTemplate = myTemplate.content.cloneNode(true);
							normalContent.innerHTML = "";
							normalContent.appendChild(clonedTemplate);

							loadSettingsPage();
      					
						});		
								
						$('#printpage').on('click', function(e) {

							e.preventDefault();
						
							$("#buttonsdiv").hide();
						
							$("#topnav").hide();

							window.emitMessage('print', '', function(status) {

								$("#buttonsdiv").show();
							
								$("#topnav").show();
						
							});
					
						});	
								
								
				}
				else
				{

					$('#viewbutton').show();
					$('#viewprogress').hide();
	
					$('#passerr').html("{{ i18n.__("Error: Unable to view account.  Check password and try again.") }}");

				}
			
			});
		
		}
	
	  })
  	
  	}
  	
  </script>
  
  {% block javascripts %}{% endblock %}
  
  <template id="templateAccountPage">
  
  	{% include 'account.twig' %}
  
  </template>
  
  <template id="templateSendPage">
  
  	{% include 'send.twig' %}
  
  </template>
  
  <template id="templateReceivePage">
  
  	{% include 'receive.twig' %}
  
  </template>
  
  <template id="templateSignPage">
  
  	{% include 'sign.twig' %}
  
  </template>
  
  <template id="templateVerifyPage">
  
  	{% include 'verify.twig' %}
  
  </template>

  <template id="templateSettingsPage">
  
  	{% include 'settings.twig' %}
  
  </template>
  
</body>

</html>
